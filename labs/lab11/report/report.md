---
## Front matter
title: "Отчёт по лабораторной работе №11"
subtitle: "Управление загрузкой системы"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с загрузчиком системы GRUB2.

# Ход выполнения

## Модификация параметров загрузчика GRUB2

1. После загрузки операционной системы Rocky Linux был запущен терминал и получены полномочия администратора.  
   Для редактирования конфигурации загрузчика открыт файл `/etc/default/grub` в текстовом редакторе nano.

   ![Редактирование файла /etc/default/grub](Screenshot_1.png)

2. В конфигурационном файле изменён параметр времени отображения меню загрузки.  
   Значение параметра **GRUB_TIMEOUT** установлено равным **10 секундам**, что обеспечивает отображение меню GRUB при запуске системы.  
   После внесения изменений файл сохранён и редактор закрыт.

3. Для применения изменений выполнена генерация нового конфигурационного файла загрузчика GRUB2.  
   Конфигурация успешно записана в файл `/boot/grub2/grub.cfg`.

   ![Генерация конфигурации GRUB2](Screenshot_2.png)

4. Система перезагружена.  
   При запуске отображено меню загрузчика **GRUB версии 2.12** с доступными версиями ядра, что подтверждает корректность внесённых изменений.

   ![Меню загрузчика GRUB](Screenshot_3.png)

5. Для проверки параметров загрузки выполнен переход в режим редактирования записи загрузчика нажатием клавиши **e**.  
   Отображена строка загрузки ядра, содержащая путь к образу ядра и initramfs.

   ![Редактирование параметров загрузки ядра](Screenshot_4.png)

## Загрузка системы в режиме rescue.target

6. В конец строки загрузки ядра добавлен параметр **systemd.unit=rescue.target**.  
   Параметры `rhgb` и `quiet` удалены для отображения процесса загрузки.  
   Загрузка продолжена с сохранением временных изменений.

7. После загрузки выполнен вход под пользователем **root**.  
   Просмотрен список загруженных модулей и служб, что подтвердило запуск системы в режиме минимальной базовой среды.

   ![Список загруженных модулей systemd](Screenshot_5.png)

## Загрузка системы в режиме emergency.target

8. Система перезагружена и снова открыт редактор параметров загрузки GRUB.  
   В строку загрузки ядра добавлен параметр **systemd.unit=emergency.target**.  
   После подтверждения изменений выполнена загрузка системы.

   ![Загрузка в режиме emergency.target](Screenshot_6.png)

9. После входа в систему просмотрен список загруженных модулей.  
   Установлено, что количество активных модулей сведено к минимально необходимому набору.

   ![Минимальный набор загруженных модулей](Screenshot_7.png)

## Сброс пароля пользователя root

10. Система перезагружена и в меню GRUB выполнен переход в режим редактирования параметров загрузки.  
    В конец строки загрузки ядра добавлен параметр **rd.break**, после чего процесс загрузки остановлен на этапе initramfs.

   ![Загрузка в режиме rd.break](Screenshot_8.png)

11. Корневая файловая система перемонтирована в режиме чтения и записи.  
    Выполнен переход в окружение установленной системы.

12. Установлен новый пароль пользователя **root**.  
    Для корректной работы SELinux загружена политика безопасности и вручную установлен правильный контекст для файла `/etc/shadow`.

   ![Установлен новый пароль](Screenshot_9.png)

# Контрольные вопросы

1. Для применения общих изменений в загрузчике GRUB2 необходимо изменить основной файл конфигурации, предназначенный для задания глобальных параметров загрузки.  
   Таким файлом является **/etc/default/grub**.  
   В нём указываются основные настройки GRUB2, такие как:
   - время отображения меню загрузки;
   - параметры командной строки ядра;
   - режим отображения меню;
   - поведение загрузчика по умолчанию.  
   Данный файл не используется напрямую при загрузке системы, а служит источником параметров для генерации итоговой конфигурации GRUB2.

2. Конфигурационным файлом GRUB2, в котором фактически применяются изменения и который используется загрузчиком при старте системы, является файл  
   **/boot/grub2/grub.cfg**.  
   Этот файл формируется автоматически на основе:
   - файла `/etc/default/grub`;
   - скриптов из каталога `/etc/grub.d/`.  
   Редактирование файла `/boot/grub2/grub.cfg` вручную не рекомендуется, так как все изменения будут перезаписаны при следующей генерации конфигурации.

3. После внесения изменений в файл `/etc/default/grub` необходимо выполнить команду генерации конфигурации GRUB2, чтобы изменения были сохранены и применены при загрузке системы.  
   Для этого используется команда:

   **grub2-mkconfig -o /boot/grub2/grub.cfg**

   В результате выполнения команды создаётся новый файл конфигурации загрузчика, учитывающий все заданные параметры.  
   Только после выполнения данной команды изменения становятся активными и начинают использоваться при следующей загрузке операционной системы.

# Заключение

В ходе выполнения лабораторной работы были изучены принципы настройки и управления загрузчиком GRUB2 в операционной системе Rocky Linux. Выполнена модификация параметров загрузки, проверена работа системы в режимах rescue и emergency, а также успешно выполнен сброс пароля пользователя root. Полученные навыки позволяют диагностировать и устранять проблемы загрузки системы, а также выполнять восстановительные операции при возникновении сбоев.
