---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Управление журналами событий в системе"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с журналами мониторинга различных событий в системе.

# Ход выполнения

## Мониторинг журнала системных событий в реальном времени

1. Для выполнения задания было открыто три вкладки терминала.  
   В каждой вкладке получены полномочия администратора.  
   Успешное получение прав суперпользователя подтверждается изменением приглашения командной строки на `root@`.

2. Во второй вкладке терминала запущен мониторинг системных сообщений в реальном времени путём отслеживания файла журнала `/var/log/messages`.  
   Данный режим позволяет в реальном времени наблюдать все события, регистрируемые системой.

3. В третьей вкладке выполнен выход из режима суперпользователя и предпринята попытка повторного получения административных прав с вводом неверного пароля.  
   В результате аутентификация завершилась неудачно.  
   Во второй вкладке терминала было зафиксировано сообщение вида `FAILED SU (to root)`, которое также сохранилось в файле `/var/log/messages`.

   ![Ошибка аутентификации при выполнении su](Screenshot_1.png)

4. В третьей вкладке терминала из-под учётной записи обычного пользователя сгенерировано пользовательское сообщение журнала.  
   Во второй вкладке терминала отобразилось соответствующее сообщение, подтверждающее его запись в системный журнал.

   ![Сообщение, добавленное в системный журнал](Screenshot_2.png)

5. Мониторинг системных сообщений в реальном времени был остановлен.  
   После этого выполнен просмотр последних 20 строк журнала безопасности `/var/log/secure`.  
   В журнале отображены записи, относящиеся к ранее выполненным неудачным попыткам аутентификации при использовании команды `su`.

   ![Просмотр журнала безопасности](Screenshot_3.png)

## Изменение правил rsyslog и настройка журналирования веб-службы

6. В первой вкладке терминала произведена установка веб-сервера Apache HTTP Server.  
   После завершения установки веб-служба была запущена и добавлена в автозагрузку системы.

   ![Установка и запуск Apache](Screenshot_4.png)

7. Во второй вкладке терминала выполнен просмотр журнала ошибок веб-службы, расположенного в каталоге `/var/log/httpd`.  
   В журнале зафиксированы сообщения о запуске Apache, загрузке модулей и применении политики SELinux.

   ![Журнал ошибок Apache](Screenshot_5.png)

8. В третьей вкладке терминала открыт файл конфигурации веб-сервера `/etc/httpd/conf/httpd.conf`.  
   В конец файла добавлена директива, перенаправляющая журнал ошибок Apache в системный журнал syslog с использованием объекта `local1`.

   ![Редактирование конфигурационного файла httpd.conf](Screenshot_6.png)

9. В каталоге `/etc/rsyslog.d` создан отдельный файл конфигурации для обработки сообщений веб-службы.  
   В нём задано правило, обеспечивающее запись всех сообщений объекта `local1` в файл `/var/log/httpd-error.log`.

   ![Настройка rsyslog для Apache](Screenshot_7.png)

10. Для применения изменений выполнена перезагрузка службы системного журналирования и веб-службы Apache.  
    После этого все сообщения об ошибках веб-службы начали записываться в указанный файл журнала.

11. В каталоге `/etc/rsyslog.d` создан отдельный файл конфигурации для регистрации отладочных сообщений системы.  
    В файле задано правило, направляющее все сообщения уровня `debug` в файл `/var/log/messages-debug`.

   ![Файл конфигурации ](Screenshot_8.png)

12. Для применения новой конфигурации служба rsyslog была перезапущена.

13. Во второй вкладке терминала запущен мониторинг файла `/var/log/messages-debug` в реальном времени.  
    После генерации отладочного сообщения в журнале отобразилась соответствующая запись, что подтвердило корректность настроек.

![Журнал ошибок](Screenshot_9.png)

14. По завершении проверки мониторинг был остановлен.

# Ход выполнения

## Использование journalctl для анализа системного журнала

1. Во второй вкладке терминала выполнен просмотр журнала событий, зафиксированных с момента последнего запуска системы.  
   Отображены сообщения ядра Linux, инициализации оборудования, запуска systemd и системных служб.  
   Для навигации по журналу использовались построчный и постраничный режимы просмотра, выход из режима просмотра выполнен стандартным способом.

   ![Просмотр журнала с момента загрузки системы](Screenshot_10.png)

2. Выполнен просмотр содержимого журнала без использования встроенного пейджера.  
   В результате все сообщения журнала были выведены непосредственно в терминал без возможности интерактивной прокрутки.

   ![Просмотр журнала без пейджера](Screenshot_11.png)

3. Запущен режим мониторинга журнала в реальном времени.  
   В процессе наблюдения отображались новые события, регистрируемые системой, включая сообщения служб и ядра.  
   После завершения наблюдения режим реального времени был остановлен.

   ![Мониторинг журнала в реальном времени](Screenshot_12.png)

4. Для изучения доступных параметров фильтрации журнала был инициирован режим автодополнения.  
   В результате отображён список возможных полей и атрибутов, по которым может быть выполнена выборка сообщений.

   ![Список параметров фильтрации journalctl](Screenshot_13.png)

5. Выполнен просмотр событий, относящихся к пользователю с идентификатором UID 0.  
   В журнале отображены сообщения, связанные с запуском системных служб и действиями, выполненными от имени суперпользователя.

   ![События пользователя UID 0](Screenshot_14.png)

6. Выполнен вывод последних 20 строк журнала.  
   В журнале зафиксированы события, связанные с работой графической подсистемы, модулей VirtualBox и обработкой аварийных завершений процессов.

   ![Последние 20 записей системного журнала](Screenshot_15.png)

7. Выполнена фильтрация журнала по уровню приоритета ошибок.  
   Отображены сообщения с критическими и ошибочными состояниями, включая проблемы драйверов, графической подсистемы и служб пользователя.

   ![Сообщения с приоритетом ошибок](Screenshot_16.png)

8. Выполнен просмотр сообщений журнала, зарегистрированных со вчерашнего дня.  
   В журнале представлены сообщения ядра, загрузки системы и инициализации аппаратных и программных компонентов.

   ![Сообщения журнала со вчерашнего дня](Screenshot_17.png)

9. Выполнен просмотр сообщений об ошибках, зафиксированных со вчерашнего дня.  
   В журнале отображены только записи с ошибочным уровнем приоритета за указанный временной интервал.

   ![Ошибки, зафиксированные со вчерашнего дня](Screenshot_18.png)

10. Выполнен вывод журнала в расширенном формате.  
    Отображена детальная информация о каждом событии, включая идентификаторы загрузки, временные метки, приоритеты, источники сообщений и дополнительные служебные поля.

    ![Детальный вывод журнала в формате verbose](Screenshot_19.png)

11. Выполнен просмотр сообщений, относящихся к службе SSH.  
    В журнале отображены записи о запуске демона, открытии сетевых портов и готовности службы к приёму подключений.

## Настройка постоянного журнала journald

1. Для выполнения настройки был запущен терминал, после чего получены полномочия администратора.  
   Работа выполнялась от имени суперпользователя, что необходимо для изменения системных каталогов и параметров службы journald.

2. В файловой системе создан каталог `/var/log/journal`, предназначенный для постоянного хранения записей журнала systemd.  
   Использование данного каталога позволяет сохранять сообщения журнала на диске, а не только в оперативной памяти.

3. Для корректной работы службы journald были изменены права доступа и владелец каталога `/var/log/journal`.  
   Каталогу назначен владелец `root` и группа `systemd-journal`, а также установлен режим доступа, обеспечивающий запись журналов и корректное наследование прав.

4. Для применения внесённых изменений службе systemd-journald был отправлен сигнал перезагрузки конфигурации.  
   Данный способ позволяет активировать постоянное журналирование без полной перезагрузки операционной системы.

5. После выполнения настройки журнал systemd стал постоянным.  
   Для проверки корректности работы выполнен просмотр сообщений журнала с момента последней загрузки системы.  
   В журнале отображаются сообщения ядра Linux, параметры загрузки и события инициализации системы, что подтверждает успешное сохранение записей на диске.

   ![Проверка постоянного журнала journald](Screenshot_20.png)

# Контрольные вопросы

1. Для настройки службы rsyslogd используется основной конфигурационный файл  
   **/etc/rsyslog.conf**.  
   Дополнительные правила и пользовательские настройки могут размещаться в отдельных
   конфигурационных файлах в каталоге **/etc/rsyslog.d/**, которые автоматически
   подключаются при запуске службы.

2. Сообщения rsyslogd, связанные с аутентификацией и авторизацией пользователей,
   записываются в файл журнала  
   **/var/log/secure**.  
   В данном файле фиксируются события входа в систему, ошибки ввода пароля,
   использование команды `su`, а также работа служб аутентификации.

3. Если параметры ротации журналов не настраивались вручную, то ротация файлов
   журналов выполняется по умолчанию средствами **logrotate**.  
   В стандартной конфигурации ротация журналов производится **один раз в сутки**
   с хранением нескольких архивных копий лог-файлов.

4. Для записи всех сообщений с приоритетом **info** в файл
   `/var/log/messages.info` в конфигурации rsyslog необходимо добавить строку:

```
*.info /var/log/messages.info
```

Данная директива указывает службе rsyslog записывать все сообщения уровня info
и выше в указанный файл.

5. Для просмотра сообщений системного журнала в режиме реального времени
используется команда:

```
journalctl -f
```

Данный режим позволяет наблюдать появление новых записей журнала по мере
их регистрации системой.

6. Для просмотра всех сообщений журнала, записанных для процесса с идентификатором
PID 1 в интервале времени с 9:00 до 15:00, используется команда:

```
journalctl _PID=1 --since "09:00" --until "15:00"
```

В результате будут отображены только те записи журнала, которые соответствуют
указанному процессу и временному диапазону.

7. Для просмотра сообщений journald после последней перезагрузки системы
применяется команда:

```
journalctl -b
```

Она выводит все события текущего загрузочного сеанса операционной системы.

8. Для того чтобы сделать журнал journald постоянным, необходимо выполнить
следующую процедуру:

- создать каталог **/var/log/journal**;
- назначить владельцем каталога пользователя `root` и группу `systemd-journal`;
- установить корректные права доступа для каталога;
- перезагрузить систему либо отправить службе systemd-journald сигнал
  перечитывания конфигурации.

После выполнения данных действий записи журнала будут сохраняться на диске
и сохраняться между перезагрузками системы.


# Заключение

В ходе выполнения лабораторной работы были изучены механизмы ведения и анализа
системных журналов в операционной системе Linux. Освоены приёмы мониторинга
журналов в реальном времени, фильтрации сообщений по различным параметрам,
а также настройки службы rsyslog для централизованной регистрации событий.
Дополнительно выполнена настройка постоянного хранения журнала systemd-journald,
что обеспечивает сохранность диагностической информации между перезагрузками
системы и повышает удобство администрирования.
