---
## Front matter
title: "Отчёт по лабораторной работе №15"
subtitle: "Управление логическими томами"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления логическими томами.

# Ход выполнения

## Создание физического тома (PV) на дополнительном диске

1. Перед началом работы проверена готовность системы к выполнению операций с LVM.  
   Точки монтирования, использовавшиеся в предыдущих заданиях, при необходимости исключены из автоподключения в файле `/etc/fstab`, после чего каталоги `/mnt/data` и `/mnt/data-ext` были размонтированы.  
   Командой `mount` без параметров подтверждено отсутствие подключённых дополнительных дисков `/dev/sdb` и `/dev/sdc`.

2. Для подготовки диска **/dev/sdb** к использованию в LVM выполнена разметка с помощью утилиты `fdisk`.  
   В интерактивном режиме создан основной раздел **/dev/sdb1** размером **300 MiB**, при этом первый сектор оставлен по умолчанию, а последний задан как `+300M`.  
   В процессе создания раздела была обнаружена существующая сигнатура файловой системы (**xfs**), которая была удалена для корректного использования раздела в LVM.  
   После этого тип раздела был изменён на **8e (Linux LVM)**, а изменения записаны на диск.

   ![Создание раздела /dev/sdb1 и назначение типа Linux LVM](Screenshot_1.png)

3. Для применения изменений в таблице разделов выполнена команда `partprobe /dev/sdb`.  
   Далее создан физический том LVM на новом разделе **/dev/sdb1**, о чём система сообщила успешным завершением операции.

   ![Создание физического тома LVM на /dev/sdb1](Screenshot_1.png)

## Создание группы томов (VG) и логического тома (LV)

4. Для проверки текущей конфигурации LVM выполнен просмотр физических томов.  
   В выводе присутствует системный физический том `/dev/sda3`, входящий в группу томов **rl_vbox**, а также созданный физический том `/dev/sdb1` размером около **300 MiB**.

5. На основе физического тома `/dev/sdb1` создана новая группа томов **vgdata**.  
   Проверка с помощью просмотра групп томов подтвердила успешное создание группы и наличие в ней свободного дискового пространства.  
   Повторный просмотр физических томов показал, что `/dev/sdb1` теперь принадлежит группе **vgdata**.

6. В группе томов **vgdata** создан логический том **lvdata**, использующий **50% свободного пространства** группы.  
   Проверка списка логических томов подтвердила создание тома **lvdata** размером около **148 MiB**.

7. На логическом томе **lvdata** создана файловая система **ext4**, подготовленная для последующего монтирования.

   ![Создание группы томов, логического тома и файловой системы ext4](Screenshot_2.png)

## Настройка монтирования и автоподключения

8. Создан каталог `/mnt/data`, который будет использоваться в качестве точки монтирования логического тома.  
   В файл `/etc/fstab` добавлена запись для автоматического подключения логического тома **/dev/vgdata/lvdata** с файловой системой **ext4** при загрузке системы.

   ![Редактирование файла /etc/fstab](Screenshot_3.png)

9. Выполнена проверка корректности настроек автоподключения.  
   После применения конфигурации файловая система была успешно смонтирована, что подтверждено выводом команды просмотра подключённых файловых систем, где отображается устройство `/dev/mapper/vgdata-lvdata`, смонтированное в каталог `/mnt/data`.

   ![Проверка монтирования логического тома](Screenshot_4.png)

## Изменение размера логических томов

10. Для увеличения доступного пространства в группе томов **vgdata** на диске `/dev/sdb` создан второй раздел **/dev/sdb2** размером **300 MiB**.  
    После создания раздела его тип был изменён на **8e (Linux LVM)**.  
    Проверка таблицы разделов подтвердила наличие двух LVM-разделов: `/dev/sdb1` и `/dev/sdb2`.

    ![Создание второго LVM-раздела /dev/sdb2](Screenshot_5.png)

11. На разделе **/dev/sdb2** создан новый физический том LVM, после чего группа томов **vgdata** была расширена за счёт добавления данного физического тома.  
    Просмотр информации о группах томов подтвердил увеличение общего объёма **vgdata** и появление дополнительного свободного пространства.  
    Проверка логических томов и файловых систем показала, что размер логического тома **lvdata** на данном этапе не изменился.

    ![Расширение группы томов vgdata](Screenshot_6.png)

12. Логический том **lvdata** был увеличен на **50% оставшегося свободного пространства** в группе томов **vgdata**.  
    Расширение файловой системы выполнено автоматически в процессе увеличения логического тома.  
    В результате размер **lvdata** увеличился примерно с **148 MiB** до **372 MiB**, что подтверждено выводом информации о логических томах и доступном дисковом пространстве.

    ![Увеличение логического тома и файловой системы](Screenshot_7.png)

13. Для демонстрации возможности уменьшения логического тома выполнено сокращение размера **lvdata** на **50 MiB**.  
    Перед уменьшением была выполнена проверка файловой системы, затем файловая система и логический том были уменьшены, после чего том автоматически смонтирован обратно.  
    В результате размер логического тома составил **224 MiB**, что подтверждено проверкой логических томов и файловых систем.

    ![Уменьшение логического тома и файловой системы](Screenshot_8.png)

## Самостоятельная работа — создание и расширение логического тома lvgroup

1. Для выполнения самостоятельной работы использован дополнительный диск **/dev/sdc**.  
   С помощью утилиты `fdisk` проверена текущая разметка диска. На диске присутствуют два раздела:
   - **/dev/sdc1** размером около **600 MiB**,
   - **/dev/sdc2** размером около **450 MiB**.  
   Оба раздела имеют тип **Linux LVM (8e)**. После проверки изменения таблицы разделов были записаны на диск, а таблица разделов перечитана ядром.

   ![Проверка разметки диска /dev/sdc и обновление таблицы разделов](Screenshot_9.png)

2. На разделе **/dev/sdc1** создан физический том LVM.  
   Далее на основе данного физического тома создана новая группа томов **vggroup**.  
   В группе томов **vggroup** создан логический том **lvgroup**, использующий **100% доступного пространства** группы томов.

3. На логическом томе **lvgroup** создана файловая система **XFS**, что подтверждается выводом утилиты форматирования.

   ![Создание PV, VG vggroup, LV lvgroup и файловой системы XFS](Screenshot_10.png)

4. Для контроля текущей конфигурации LVM выполнен просмотр физических томов, групп томов и логических томов.  
   В выводе видно:
   - физический том `/dev/sdc1`, принадлежащий группе **vggroup**,
   - группа томов **vggroup** с одним логическим томом,
   - логический том **lvgroup** размером около **596 MiB**.

   ![Проверка конфигурации LVM: pvs, vgs, lvs](Screenshot_11.png)

5. Подготовлена точка монтирования `/mnt/groups`.  
   В файл `/etc/fstab` добавлена строка для постоянного подключения логического тома **/dev/vggroup/lvgroup** с файловой системой **XFS**.  
   Ранее использовавшиеся или временные записи были закомментированы.

   ![Настройка автоподключения lvgroup в /etc/fstab](Screenshot_12.png)

6. Выполнена проверка монтирования файловых систем.  
   Логический том **lvgroup** успешно смонтирован в каталог `/mnt/groups`, что подтверждено просмотром подключённых файловых систем и текущего использования дискового пространства.

   ![Проверка монтирования /mnt/groups и вывода df -h](Screenshot_13.png)

7. После перезагрузки виртуальной машины выполнена проверка конфигурации, которая подтвердила, что логический том **lvgroup** автоматически подключается в каталог `/mnt/groups`.

8. Для увеличения доступного пространства создан физический том на разделе **/dev/sdc2**.  
   Далее группа томов **vggroup** была расширена за счёт добавления нового физического тома.  
   Проверка конфигурации подтвердила увеличение общего размера группы томов.

9. Логический том **lvgroup** был увеличен на **100% свободного пространства** группы томов **vggroup** с одновременным расширением файловой системы **XFS**.  
   В процессе изменения размера была автоматически расширена файловая система без необходимости размонтирования тома.

   ![Расширение VG и LV с автоматическим увеличением файловой системы XFS](Screenshot_14.png)

10. После завершения операции выполнена итоговая проверка состояния системы.  
    Просмотр физических томов, групп томов и логических томов подтвердил:
    - наличие двух физических томов в группе **vggroup**,
    - увеличение размера логического тома **lvgroup** до значения менее **1 ГБ**.  
    Команда просмотра использования дискового пространства подтвердила, что файловая система **/mnt/groups** успешно увеличена и доступна для использования.

    ![Итоговая проверка размеров LV и файловых систем](Screenshot_15.png)

# Контрольные вопросы

1. В таблице разделов **GUID (GPT)** для работы с LVM используется специальный тип раздела **Linux LVM**.  
   Данный тип имеет GUID `E6D6D379-F507-44C2-A23C-238F2A3DF928` и предназначен для обозначения разделов, используемых как физические тома LVM.

2. Для создания группы томов с именем **vggroup**, которая содержит физическое устройство `/dev/sdb3` и использует размер физического экстента **4 MiB**, применяется команда:

   `vgcreate -s 4M vggroup /dev/sdb3`

3. Краткую сводку физических томов в системе, а также информацию о группах томов, к которым они принадлежат, выводит команда:

   `pvs`

4. Чтобы добавить весь жёсткий диск `/dev/sdd` в группу томов, необходимо выполнить следующие действия:
   - создать физический том на всём диске `/dev/sdd`;
   - затем расширить существующую группу томов, добавив в неё данный физический том.

   Таким образом, сначала диск подготавливается как физический том LVM, после чего включается в группу томов.

5. Для создания логического тома **lvvol1** размером **6 MiB** используется команда:

   `lvcreate -n lvvol1 -L 6M имя_группы_томов`

6. Чтобы добавить **100 МБ** к логическому тому **lvvol1**, при условии что свободное пространство доступно в группе томов, применяется команда:

   `lvextend -L +100M /dev/имя_группы_томов/lvvol1`

7. Если требуется добавить ещё **200 МБ** к логическому тому, но в группе томов отсутствует свободное пространство, первым шагом является **расширение группы томов**.  
   Для этого необходимо добавить новый физический том в группу томов, предварительно создав его на дополнительном диске или разделе.

8. Для того чтобы при увеличении логического тома одновременно изменить размер файловой системы, с командой `lvextend` используется опция:

   `-r`

   Данная опция автоматически выполняет расширение файловой системы после изменения размера логического тома.

9. Чтобы посмотреть, какие логические тома доступны в системе, используется команда:

   `lvs`

10. Для проверки целостности файловой системы на устройстве `/dev/vgdata/lvdata` применяется команда:

    `e2fsck /dev/vgdata/lvdata`

    Данная команда используется для проверки и исправления ошибок файловых систем семейства ext.

# Заключение

В ходе выполнения лабораторной и самостоятельной работы были освоены основные операции управления логическими томами LVM. Выполнено создание физических томов, групп томов и логических томов, а также их форматирование в файловые системы ext4 и XFS. Настроено постоянное монтирование логических томов с использованием файла `/etc/fstab`, подтверждена корректность автоматического подключения после перезагрузки системы.

Дополнительно были отработаны операции динамического изменения размеров логических томов и файловых систем, включая расширение и уменьшение без потери данных. В результате получены практические навыки гибкого управления дисковым пространством в Linux с использованием LVM, что является важной частью администрирования современных серверных систем.
