---
## Front matter
title: "Отчёт по лабораторной работе №5"
subtitle: "Управление системными службами"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления системными службами операционной системы посредством systemd.

# Ход выполнения

## Управление сервисом Very Secure FTP (vsftpd)

1. Для выполнения административных операций получены полномочия суперпользователя.  
   После успешной аутентификации приглашение командной строки изменилось, что подтверждает переход в режим администратора.

   ![Получение прав суперпользователя и проверка статуса службы vsftpd](Screenshot_1.png)

2. Выполнена проверка состояния службы **Very Secure FTP**.  
   Результат проверки показал, что юнит **vsftpd.service** не найден, что свидетельствует об отсутствии установленной службы в системе на данный момент.

3. Для установки службы **Very Secure FTP** был использован менеджер пакетов.  
   В процессе установки были автоматически разрешены зависимости, загружен и установлен пакет **vsftpd версии 3.0.5-10.el10** из репозитория *appstream*.

   ![Установка пакета vsftpd](Screenshot_1.png)

4. После завершения установки служба **vsftpd** была запущена вручную.  
   Запуск прошёл успешно, без сообщений об ошибках.

5. Повторная проверка состояния службы показала, что она находится в состоянии **active (running)**.  
   При этом параметр загрузки имеет значение **disabled**, что означает отсутствие автоматического запуска службы при перезагрузке операционной системы.

   ![Статус службы vsftpd после запуска](Screenshot_2.png)

6. Для добавления службы **vsftpd** в автозапуск была выполнена соответствующая операция.  
   В системе была создана символическая ссылка, указывающая на файл юнита службы.  
   После этого статус службы изменился на **enabled**.  
   Далее служба была удалена из автозапуска, и её состояние загрузки вновь стало **disabled**.

   ![Включение и отключение автозапуска vsftpd](Screenshot_3.png)

7. Был выведен список символических ссылок, отвечающих за запуск сервисов в режиме **multi-user**.  
   В результате было подтверждено отсутствие ссылки на **vsftpd.service**, что соответствует отключённому автозапуску службы.

   ![Каталог multi-user.target.wants без vsftpd](Screenshot_4.png)

8. Служба **vsftpd** повторно добавлена в автозапуск.  
   Повторный просмотр каталога автозапуска показал наличие символической ссылки **vsftpd.service**, указывающей на системный файл юнита.

   ![Созданная символическая ссылка vsftpd.service](Screenshot_4.png)

9. Проверка статуса службы подтвердила изменение состояния загрузки на **enabled**, при этом служба продолжает корректно работать в активном состоянии.

   ![Статус службы vsftpd после включения автозапуска](Screenshot_4.png)

10. Был выведен список зависимостей юнита **vsftpd**.  
    Отображённые зависимости показывают, какие цели и службы необходимы для корректного функционирования FTP-сервиса.

11. Также был получен список юнитов, которые зависят от службы **vsftpd**.  
    В результате отображены цели **multi-user.target** и **graphical.target**, что указывает на возможность использования службы в соответствующих режимах работы системы.

   ![Зависимости и обратные зависимости vsftpd](Screenshot_5.png)

## Разрешение конфликтов юнитов (iptables и firewalld)

1. Для демонстрации конфликтов системных служб в систему был установлен пакет **iptables** вместе с необходимыми компонентами и сервисными файлами.

   ![Установка iptables](Screenshot_6.png)

2. Выполнена проверка состояния служб **firewalld** и **iptables**.  
   Служба **firewalld** находилась в активном состоянии, в то время как служба **iptables** была неактивна.

3. Была предпринята попытка запуска обеих служб.  
   В результате выявлено, что данные сервисы конфликтуют между собой, и одновременная их работа невозможна: при запуске одной службы вторая останавливается либо не запускается.

   ![Конфликт firewalld и iptables](Screenshot_6.png)

4. Был изучен файл юнита **firewalld.service**.  
   В его настройках указана директива **Conflicts=iptables.service**, которая запрещает одновременный запуск firewalld и iptables.

   ![Содержимое firewalld.service](Screenshot_7.png)

5. Аналогично был рассмотрен файл **iptables.service**.  
   Прямых указаний на конфликт в данном юните не содержится, однако конфликт определяется настройками службы firewalld.

   ![Содержимое iptables.service](Screenshot_8.png)

6. Для исключения влияния iptables служба была выгружена, после чего служба **firewalld** была успешно запущена и продолжила работу в активном состоянии.

7. Для предотвращения случайного запуска службы **iptables** она была замаскирована.  
   В результате была создана символическая ссылка на **/dev/null**, имеющая приоритет над системным файлом юнита.

   ![Маскирование службы iptables](Screenshot_9.png)

8. Попытка запуска замаскированной службы завершилась ошибкой, указывающей, что юнит замаскирован и не может быть активирован.

9. Попытка добавить службу **iptables** в автозапуск также завершилась неудачно.  
   Статус загрузки службы отображается как **masked**, что подтверждает невозможность её автоматического или ручного запуска.

   ![Ошибка запуска и включения iptables](Screenshot_9.png)

## Изолируемые цели systemd

1. Для выполнения административных операций получены полномочия суперпользователя.  
   После этого выполнен переход в каталог, содержащий системные unit-файлы systemd.  
   С помощью поиска по файлам целей был получен список целей, поддерживающих изоляцию.  
   В результате установлено, что изолируемые цели содержат параметр **AllowIsolate=yes**, что позволяет использовать их в качестве цели по умолчанию и переключаться на них во время работы системы.

   ![Список изолируемых целей systemd](Screenshot_10.png)

2. Для проверки механизма изоляции операционная система была переведена в режим восстановления.  
   В процессе перехода система остановила большинство сервисов и запросила пароль пользователя **root** для продолжения работы в режиме восстановления.

   ![Переход системы в режим rescue.target](Screenshot_11.png)

3. После работы в режиме восстановления выполнен перезапуск операционной системы путём изоляции цели **reboot.target**.  
   Данный способ перезапуска инициирует корректное завершение работы системы и её последующую перезагрузку.

## Цель загрузки по умолчанию

1. После загрузки системы получены полномочия администратора и выведена текущая цель загрузки по умолчанию.  
   В результате установлено, что системой используется цель **graphical.target**, что соответствует загрузке с графическим интерфейсом.

   ![Просмотр цели загрузки по умолчанию](Screenshot_12.png)

2. Для изменения цели загрузки по умолчанию была выполнена установка текстового режима.  
   В результате была обновлена символическая ссылка **default.target**, указывающая на **multi-user.target**.  
   После перезагрузки системы подтверждено, что загрузка выполнена в текстовом режиме без графической оболочки.

3. Далее цель загрузки по умолчанию была изменена обратно на **graphical.target**.  
   Символическая ссылка **default.target** была переназначена на соответствующий файл юнита.  
   После повторной перезагрузки системы подтверждена корректная загрузка в графическом режиме.

   ![Установка graphical.target в качестве цели по умолчанию](Screenshot_13.png)

# Контрольные вопросы

1. **Юнит (unit)** — это базовый объект управления в системе **systemd**, описывающий ресурс или действие, которым может управлять система инициализации.  
   Юниты представлены в виде файлов конфигурации и используются для запуска, остановки и контроля различных компонентов системы.

   Основные примеры юнитов:
   - **service** — описывает системные службы и демоны  
     (например, vsftpd.service, firewalld.service);
   - **target** — логические группы юнитов, соответствующие состояниям системы  
     (например, multi-user.target, graphical.target);
   - **mount** — точки монтирования файловых систем  
     (например, home.mount);
   - **socket** — сокеты для активации служб по требованию;
   - **timer** — задания, выполняемые по расписанию (аналог cron).

2. Чтобы убедиться, что цель или служба больше не входит в список автоматического запуска при загрузке системы, используется проверка состояния загрузки юнита.  
   В выводе информации о юните необходимо обратить внимание на параметр **Loaded**, который должен иметь значение **disabled**.  
   Дополнительно можно проверить отсутствие символической ссылки в каталоге  
   `/etc/systemd/system/multi-user.target.wants/`.

3. Для отображения всех сервисных юнитов, которые в настоящее время загружены в систему, используется вывод списка юнитов типа **service**.  
   Данная команда позволяет увидеть только активные и загруженные сервисы без отображения остановленных или неустановленных юнитов.

4. Чтобы создать потребность (**wants**) одного юнита в другом сервисе, используется добавление зависимости типа *Wants*.  
   Это может быть выполнено путём создания символической ссылки на сервис в каталоге соответствующей цели либо с помощью команды управления systemd.  
   Такая зависимость означает, что при запуске основного юнита systemd попытается запустить указанный сервис, но его отказ не приведёт к остановке основной цели.

5. Для переключения текущего состояния системы в режим восстановления используется изоляция цели **rescue.target**.  
   При этом systemd завершает работу большинства сервисов, переводит систему в минимальное состояние и запрашивает пароль пользователя root для продолжения работы.

6. Сообщение о том, что цель не может быть изолирована, возникает в том случае, если в её unit-файле отсутствует параметр  
   **AllowIsolate=yes**.  
   Это означает, что данная цель не предназначена для прямого переключения и может быть использована только как зависимость другой цели, но не как самостоятельное состояние системы.

7. Для определения того, какие другие юниты зависят от выбранной службы, используется вывод обратных зависимостей.  
   Данная команда позволяет увидеть все цели и сервисы, которые требуют указанный юнит для своей работы, что особенно важно перед его отключением или удалением.


# Заключение

В ходе выполнения лабораторной работы были изучены принципы управления системными службами и целями в системе инициализации systemd. Освоены операции установки, запуска, остановки и настройки автозапуска сервисов, а также анализ их зависимостей. Получены практические навыки работы с изолируемыми целями, изменения цели загрузки по умолчанию и разрешения конфликтов между службами. Приобретённые знания позволяют эффективно управлять состоянием операционной системы и её сервисами в процессе администрирования.
