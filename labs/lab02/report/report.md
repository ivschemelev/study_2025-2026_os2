---
## Front matter
title: "Отчёт по лабораторной работе №2"
subtitle: "Управление пользователями и группами"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить представление о работе с учётными записями пользователей и группами пользователей в операционной системе типа Linux.

# Ход выполнения

## Переключение учётных записей пользователей и проверка идентификаторов

1. Выполнен вход в систему под обычной учётной записью и открыт терминал.  
   Для определения текущего пользователя использована команда whoami, в результате чего отображено имя активной учётной записи **ivschemelev**.  
   Далее выведена расширенная информация командой id.

   Команда id отобразила:
   - uid=1000(ivschemelev) — уникальный идентификатор пользователя (User ID);
   - gid=1000(ivschemelev) — идентификатор основной группы (Group ID);
   - groups=1000(ivschemelev),10(wheel) — список групп, в которые входит пользователь;
   - context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 — SELinux-контекст процесса, указывающий на отсутствие ограничений политики.

   ![Определение текущего пользователя и вывод id](Screenshot_1.png)

2. Для получения привилегий администратора выполнена команда su и введён пароль пользователя root.  
   После переключения повторно выполнена команда id, что подтвердило успешный вход под учётной записью суперпользователя:
   - uid=0(root) и gid=0(root) — идентификаторы root;
   - groups=0(root) — принадлежность к основной группе root;
   - SELinux-контекст соответствует непривилегированному режиму unconfined.

   ![Проверка идентификаторов пользователя root](Screenshot_1.png)

3. Выполнен выход из сеанса root с помощью команды exit, после чего терминал вернулся к исходной учётной записи пользователя ivschemelev.

4. Файл конфигурации /etc/sudoers открыт с использованием утилиты visudo в режиме суперпользователя.  
   Использование visudo является обязательным, так как данная утилита:
   - проверяет синтаксис файла перед сохранением;
   - предотвращает сохранение ошибок, способных полностью нарушить работу sudo;
   - блокирует файл от одновременного редактирования.

   ![Открытие файла /etc/sudoers через visudo](Screenshot_2.png)

5. В файле /etc/sudoers обнаружена строка:

   %wheel ALL=(ALL) ALL

   Данная запись означает, что все пользователи, входящие в группу wheel, имеют право выполнять любые команды с использованием sudo от имени любого пользователя, включая root.  
   Группа wheel используется для предоставления административных полномочий доверенным пользователям системы.

   ![Строка с настройкой группы wheel](Screenshot_3.png)

6. Создан пользователь alice, добавленный в группу wheel.  
   Проверка членства выполнена командой id alice, что подтвердило наличие группы wheel в списке вторичных групп.

   ![Проверка принадлежности пользователя alice к группе wheel](Screenshot_4.png)

7. Для пользователя alice установлен пароль. При вводе короткого пароля система вывела предупреждение, после чего пароль был успешно обновлён.

8. Выполнено переключение на учётную запись alice.  
   Под пользователем alice создан пользователь bob. Для выполнения операции использован sudo, так как создание пользователей требует административных привилегий.

9. Для пользователя bob установлен пароль.  
   Проверка id bob показала, что пользователь имеет собственную основную группу и не входит в административные группы.

   ![Создание пользователя bob и проверка его идентификаторов](Screenshot_4.png)

## Создание учётных записей пользователей

10. Под учётной записью root открыт файл /etc/login.defs для редактирования.  
    В файле изменены следующие параметры:
    - CREATE_HOME установлен в значение yes, что обеспечивает автоматическое создание домашнего каталога;
    - USERGROUPS_ENAB установлен в значение no, что отключает создание одноимённой группы для каждого нового пользователя и приводит к использованию общей группы users.

    ![Изменение параметров в файле /etc/login.defs](Screenshot_5.png)

11. Выполнен переход в каталог /etc/skel, используемый как шаблон домашних каталогов.  
    В нём созданы каталоги Pictures и Documents, которые автоматически копируются в домашние каталоги новых пользователей.

    ![Создание каталогов Pictures и Documents в /etc/skel](Screenshot_7.png)

12. В файл /etc/skel/.bashrc добавлена переменная окружения EDITOR, указывающая на текстовый редактор vim.  
    Это позволяет использовать данный редактор по умолчанию в программах, требующих редактирования текстовых файлов.

    ![Редактирование файла .bashrc в /etc/skel](Screenshot_6.png)

13. Под пользователем alice создан новый пользователь carol, после чего установлен пароль.

14. Выполнен вход под учётной записью carol.  
    Команда id показала, что основной группой пользователя является users, а не группа carol, что подтверждает корректность настройки USERGROUPS_ENAB.  
    Просмотр содержимого домашнего каталога подтвердил автоматическое создание каталогов Pictures и Documents.

    ![Проверка идентификаторов и домашнего каталога пользователя carol](Screenshot_7.png)

15. Выполнен просмотр строки, соответствующей пользователю carol, в файле /etc/shadow.  
    Запись содержит хеш пароля, дату последнего изменения и параметры политики срока действия пароля.

    ![Просмотр записи пользователя carol в файле /etc/shadow](Screenshot_8.png)

16. Для пользователя carol изменены параметры политики пароля:
    - минимальный срок использования пароля — 30 дней;
    - максимальный срок действия — 90 дней;
    - предупреждение об истечении срока — за 3 дня.

    Повторный просмотр /etc/shadow подтвердил внесённые изменения.

17. Проверено наличие записей пользователя alice в файлах /etc/passwd, /etc/shadow и /etc/group — пользователь присутствует во всех трёх файлах.  
    Для пользователя carol подтверждено отсутствие одноимённой группы в /etc/group, что соответствует ранее заданной конфигурации.

## Работа с группами пользователей

18. Под пользователем alice созданы группы main и third.  
    Пользователи alice и bob добавлены в группу main, пользователь carol — в группу third с сохранением существующих групп.

19. Проверка командой id показала:
    - пользователь carol имеет основную группу users и вторичную группу third;
    - пользователь bob состоит в основной группе bob и вторичной группе main;
    - пользователь alice состоит в основной группе alice, административной группе wheel и вторичной группе main.

    ![Проверка членства пользователей в группах](Screenshot_9.png)


# Контрольные вопросы

1. Информацию об идентификаторе пользователя (UID) и о группах, в которые он включён, можно получить с помощью следующих команд:

   - **id** — выводит полную информацию о пользователе: UID, GID и список дополнительных групп.  
     Данная команда является основной для анализа прав и принадлежности пользователя к группам.
   - **groups** — отображает только список групп, в которые входит пользователь.
   - **getent passwd имя_пользователя** — позволяет получить запись о пользователе из системной базы данных, включая UID и GID.
   - **whoami** — показывает имя текущего пользователя, что может быть использовано совместно с командой id для уточнения информации.

2. Пользователь **root** всегда имеет идентификатор **UID = 0**, что отличает его от всех остальных пользователей и предоставляет ему неограниченные права в системе.

   Узнать UID пользователя можно с помощью следующих команд:
   - **id root** — выводит UID, GID и группы пользователя root;
   - **getent passwd root** — отображает строку из файла /etc/passwd, в которой вторым числовым полем указан UID;
   - **id имя_пользователя** — применяется для определения UID любого пользователя.

   Например, вывод команды id root содержит значение `uid=0(root)`.

3. Различие между командами **su** и **sudo** заключается в следующем:

   - **su** (switch user) позволяет полностью переключиться на другую учётную запись, чаще всего на root. При этом требуется ввод пароля целевого пользователя, а новая оболочка запускается с его правами.
   - **sudo** позволяет выполнять отдельные команды с повышенными привилегиями, не покидая текущую учётную запись. В большинстве случаев используется пароль текущего пользователя, а не пароль root.

   Таким образом, su предназначена для полного перехода к другой учётной записи, тогда как sudo используется для временного повышения привилегий.

4. Параметры работы утилиты sudo и правила предоставления прав определяются в конфигурационном файле **/etc/sudoers**, а также в дополнительных файлах, расположенных в каталоге **/etc/sudoers.d/**.

5. Для безопасного изменения конфигурации sudo следует использовать команду **visudo**.  
   Эта утилита проверяет синтаксис файла перед сохранением и предотвращает внесение ошибок, которые могут привести к полной блокировке доступа к sudo.

6. Для предоставления пользователю доступа ко всем административным командам через sudo он должен быть членом группы **wheel**.  
   Это обеспечивается наличием строки `%wheel ALL=(ALL) ALL` в файле /etc/sudoers.

7. Параметры, используемые при создании учётных записей пользователей, определяются следующими файлами и каталогами:

   - **/etc/login.defs** — задаёт общие правила создания пользователей, такие как:
     - автоматическое создание домашнего каталога (CREATE_HOME);
     - использование общей группы users вместо одноимённой группы пользователя (USERGROUPS_ENAB).
   - **/etc/default/useradd** — содержит значения параметров по умолчанию для команды useradd.
   - **/etc/skel/** — каталог-шаблон, содержимое которого копируется в домашний каталог нового пользователя (например, каталоги Documents и Pictures, файл .bashrc).

8. Информация о первичной и дополнительных группах пользователей хранится в следующих файлах:

   - **/etc/passwd** — содержит основную информацию о пользователе, включая UID, GID и домашний каталог;
   - **/etc/group** — содержит сведения о группах и списки пользователей, входящих в эти группы;
   - **/etc/shadow** — хранит информацию о паролях и политике их использования.

   Для пользователя **alice**:
   - в файле /etc/passwd указан её UID и идентификатор основной группы;
   - в файле /etc/group указано членство в группах alice, wheel и main;
   - в файле /etc/shadow содержится зашифрованный пароль и параметры его срока действия.

9. Для изменения информации о пароле пользователя, включая срок действия и ограничения, используются следующие команды:

   - **passwd** — изменяет пароль пользователя;
   - **passwd -x, -n, -w** — позволяет управлять максимальным сроком действия пароля, минимальным сроком и периодом предупреждения;
   - **chage** — специализированная утилита для изменения и просмотра политики срока действия пароля.

10. Для прямого изменения информации в файле **/etc/group** следует использовать команду **vigr**.  
    Данная команда, аналогично visudo, обеспечивает блокировку файла и проверку корректности изменений, предотвращая повреждение структуры системных файлов и возможную потерю доступа к группам.

# Заключение

В ходе лабораторной работы были изучены и практически освоены основные механизмы управления пользователями и группами в операционной системе Linux. Были выполнены операции переключения между учётными записями, получения и анализа идентификаторов пользователей и групп, а также рассмотрены различия между использованием команд su и sudo.

В процессе работы проведена настройка конфигурации sudo, создана административная группа пользователей и проверены принципы предоставления привилегий через группу wheel. Были созданы новые учётные записи пользователей, настроены параметры их создания с использованием файлов /etc/login.defs и каталога /etc/skel, а также проверено влияние данных настроек на структуру домашних каталогов.

Дополнительно изучено назначение системных файлов /etc/passwd, /etc/shadow и /etc/group, выполнен анализ записей пользователей и параметров политики паролей, включая срок их действия. В заключительной части работы отработаны навыки создания и управления группами, а также назначения пользователей в первичные и вторичные группы.
