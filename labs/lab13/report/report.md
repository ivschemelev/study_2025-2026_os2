---
## Front matter
title: "Отчёт по лабораторной работе №13"
subtitle: "Фильтр пакетов"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки настройки пакетного фильтра в Linux.

# Ход выполнения

## Управление брандмауэром с помощью firewall-cmd

1. Для выполнения административных операций получены полномочия суперпользователя.  
   В терминале выполнен вход в привилегированную оболочку командой su -, после чего дальнейшие действия выполнялись от имени root.

2. Определена зона брандмауэра, используемая по умолчанию.  
   С помощью команды firewall-cmd --get-default-zone установлено, что зоной по умолчанию является public, что указывает на активную стандартную зону для сетевого интерфейса системы.

3. Получен список доступных зон firewalld.  
   Командой firewall-cmd --get-zones выведен перечень зон, включая public, home, internal, trusted и другие, что подтверждает стандартную конфигурацию межсетевого экрана.

4. Просмотрены службы, доступные для использования в правилах брандмауэра.  
   Командой firewall-cmd --get-services получен полный список предопределённых сервисов, таких как ssh, cockpit, vnc-server и другие, которые могут быть добавлены в зоны.

5. Определены службы, разрешённые в текущей зоне.  
   С помощью команды firewall-cmd --list-services установлено, что в зоне public разрешены службы cockpit, dhcpv6-client и ssh.

   ![Службы текущей зоны](Screenshot_1.png)

6. Выполнено сравнение вывода команд firewall-cmd --list-all и firewall-cmd --list-all --zone=public.  
   В обоих случаях отображается идентичная информация, поскольку зона public является зоной по умолчанию и одновременно активной зоной системы.

   ![Вывод firewall-cmd --list-all](Screenshot_2.png)  
   
   ![Вывод firewall-cmd --list-all --zone=public](Screenshot_3.png)

7. В конфигурацию времени выполнения брандмауэра добавлен сервис VNC.  
   Командой firewall-cmd --add-service=vnc-server сервис vnc-server был успешно добавлен в зону public.

8. Выполнена проверка добавленного сервиса.  
   При выводе конфигурации с помощью firewall-cmd --list-all подтверждено присутствие сервиса vnc-server в списке разрешённых сервисов зоны.

   ![Проверка добавленного сервиса](Screenshot_4.png)

9. Выполнен перезапуск службы firewalld.  
   Перезапуск выполнен с целью проверки сохранности ранее внесённых изменений.

10. После перезапуска службы firewalld выполнена повторная проверка конфигурации.  
    Установлено, что сервис vnc-server отсутствует в списке разрешённых сервисов.

   ![Сервис vnc-server отсутствует после перезапуска](Screenshot_5.png)

   Пояснение причины:  
   Сервис vnc-server был добавлен только в конфигурацию времени выполнения. При перезапуске службы firewalld runtime-конфигурация сбрасывается и загружается постоянная конфигурация, в которой данный сервис отсутствовал.

11. Сервис vnc-server добавлен в постоянную конфигурацию брандмауэра.  
    Использование параметра --permanent обеспечивает сохранение правила на диске.

12. Выполнена проверка конфигурации сразу после добавления сервиса в permanent.  
    Сервис vnc-server по-прежнему не отображается в выводе, так как изменения в постоянной конфигурации не применяются автоматически к конфигурации времени выполнения.

   ![Runtime-конфигурация без изменений](Screenshot_6.png)

13. Выполнена перезагрузка конфигурации firewalld.  
    После выполнения reload постоянная конфигурация была применена к текущей, и сервис vnc-server появился в списке разрешённых.

   ![Применение permanent-конфигурации](Screenshot_7.png)

14. В постоянную конфигурацию межсетевого экрана добавлен порт 2022 протокола TCP.  
    После добавления порта выполнена перезагрузка конфигурации firewalld для применения изменений.

15. Выполнена итоговая проверка конфигурации брандмауэра.  
    Установлено, что порт 2022/tcp присутствует в списке открытых портов, а сервис vnc-server корректно добавлен в конфигурацию зоны public.

   ![Итоговая конфигурация firewalld](Screenshot_8.png)

## Управление брандмауэром с помощью firewall-config

1. Осуществлён запуск графического интерфейса управления брандмауэром.  
   В терминале под учётной записью пользователя выполнен запуск утилиты **firewall-config**.  
   При запуске был запрошен пароль пользователя с административными полномочиями для управления службой firewalld. После аутентификации интерфейс был успешно открыт.

2. Выполнен переход к постоянной конфигурации брандмауэра.  
   В верхней части окна в параметре **Configuration** из выпадающего списка выбрано значение **Permanent**, что обеспечивает сохранение всех вносимых изменений в постоянной конфигурации и их автоматическую загрузку после перезагрузки системы.

3. В зоне **public** включены службы **http**, **https** и **ftp**.  
   В списке зон выбрана зона **public**, после чего на вкладке **Services** отмечены соответствующие службы. Данные действия разрешают доступ к веб-сервисам и FTP-серверу через межсетевой экран.

   ![Включение служб http, https и ftp](Screenshot_9.png)

4. В зону **public** добавлен порт **2022** с протоколом **UDP**.  
   На вкладке **Ports** нажата кнопка **Add**, в открывшемся диалоговом окне указан порт **2022** и выбран протокол **udp**, после чего изменения подтверждены нажатием кнопки **OK**.

   ![Добавление порта 2022/udp](Screenshot_10.png)

5. Утилита **firewall-config** закрыта после завершения конфигурирования.  
   Все изменения были сохранены в постоянной конфигурации брандмауэра, но ещё не применены к конфигурации времени выполнения.

6. Выполнена проверка текущей конфигурации брандмауэра через терминал.  
   При просмотре конфигурации с помощью команды firewall-cmd --list-all установлено, что добавленные службы и порт отсутствуют в выводе, так как изменения были выполнены в режиме **Permanent** и ещё не применены к runtime-конфигурации.

7. Выполнена перезагрузка конфигурации firewalld.  
   После выполнения reload постоянная конфигурация была применена к конфигурации времени выполнения. Повторный просмотр настроек подтвердил наличие добавленных служб и порта.

   ![Применение permanent-конфигурации](Screenshot_11.png)

## Самостоятельная работа

8. В постоянную конфигурацию брандмауэра добавлена служба **telnet** с использованием командной строки.  
   Служба telnet добавлена в зону public как постоянная, после чего конфигурация была перезагружена для применения изменений.

9. С помощью графического интерфейса firewall-config в зону **public** добавлены службы **imap**, **pop3** и **smtp**.  
   Для каждой службы была установлена отметка на вкладке **Services** при активном режиме **Permanent**, что обеспечило сохранение конфигурации на диске.

   ![Добавление служб imap, pop3 и smtp через GUI](Screenshot_12.png)

10. Выполнена итоговая проверка конфигурации межсетевого экрана.  
    Просмотр конфигурации подтвердил, что службы **telnet**, **imap**, **pop3**, **smtp**, а также ранее добавленные **http**, **https**, **ftp**, **vnc-server** и порт **2022/tcp, 2022/udp** присутствуют в зоне **public**.  
    Таким образом, конфигурация является постоянной и будет автоматически активирована после перезагрузки системы.

   ![Итоговая конфигурация firewalld](Screenshot_13.png)

# Контрольные вопросы

1. Перед началом работы с менеджером конфигурации брандмауэра **firewall-config** должна быть запущена служба **firewalld**.  
   Данная служба является фоновым демоном, который управляет правилами межсетевого экрана. Без её запуска графический интерфейс firewall-config не сможет подключиться к системе управления брандмауэром и применить настройки.

2. Для добавления UDP-порта **2355** в конфигурацию брандмауэра в зоне по умолчанию используется команда:  
   **firewall-cmd --add-port=2355/udp**.  
   Эта команда добавляет указанный порт в конфигурацию времени выполнения активной зоны.

3. Для отображения полной конфигурации брандмауэра для всех зон применяется команда:  
   **firewall-cmd --list-all-zones**.  
   Она выводит параметры всех зон, включая разрешённые службы, открытые порты, интерфейсы и дополнительные правила.

4. Для удаления службы **vnc-server** из текущей (runtime) конфигурации брандмауэра используется команда:  
   **firewall-cmd --remove-service=vnc-server**.  
   Удаление производится только из конфигурации времени выполнения и не затрагивает постоянную конфигурацию, если не указан параметр permanent.

5. Для активации новой конфигурации, добавленной с использованием параметра **--permanent**, применяется команда:  
   **firewall-cmd --reload**.  
   Эта команда перечитывает постоянную конфигурацию и применяет её к текущей рабочей конфигурации брандмауэра.

6. Для проверки того, что новая конфигурация была добавлена в текущую зону и является активной, используется команда:  
   **firewall-cmd --list-all**.  
   Она отображает параметры активной зоны, включая разрешённые службы и открытые порты.

7. Для добавления сетевого интерфейса **eno1** в зону **public** используется команда:  
   **firewall-cmd --zone=public --add-interface=eno1**.  
   После выполнения команды указанный интерфейс будет привязан к выбранной зоне.

8. Если при добавлении нового интерфейса в конфигурацию брандмауэра зона не указана явно, интерфейс будет добавлен в **зону по умолчанию**.  
   Зона по умолчанию определяется настройками firewalld и может быть просмотрена с помощью команды **firewall-cmd --get-default-zone**.

# Заключение

В ходе выполнения работы были изучены и отработаны основные способы управления межсетевым экраном firewalld с использованием как командной строки, так и графического интерфейса firewall-config. Были рассмотрены различия между конфигурацией времени выполнения и постоянной конфигурацией, а также порядок применения изменений. Полученные навыки позволяют настраивать доступ к сетевым службам и портам, обеспечивая корректную и устойчивую работу системы после перезагрузки.
