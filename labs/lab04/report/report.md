---
## Front matter
title: "Отчёт по лабораторной работе №4"
subtitle: "Работа с программными пакетами"
author: "Щемелев Илья Владимирович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с репозиториями и менеджерами пакетов.

# Ход выполнения

## Работа с репозиториями и пакетным менеджером DNF в Rocky Linux

1. Для выполнения административных операций в системе был выполнен вход в режим суперпользователя.  
   Это позволило получить полный доступ к системным каталогам и операциям управления репозиториями и пакетами.

2. Выполнен переход в каталог `/etc/yum.repos.d`, содержащий конфигурационные файлы репозиториев Rocky Linux.  
   С помощью просмотра содержимого каталога получен список доступных файлов репозиториев, среди которых присутствуют:
   **rocky.repo**, **rocky-extras.repo**, **rocky-addons.repo**, **rocky-devel.repo**.  
   Далее был изучен файл `rocky.repo`.

   В данном файле описаны параметры репозитория **BaseOS**, включая:
   - использование mirrorlist для автоматического выбора зеркал;
   - состояние репозитория (включён);
   - срок актуальности метаданных;
   - путь к GPG-ключу, используемому для проверки подлинности пакетов.

   ![Просмотр содержимого репозитория rocky.repo](Screenshot_1.png)

3. Выведен список активных репозиториев системы.  
   В результате отображены следующие репозитории:
   - **Rocky Linux 10 – AppStream** — содержит дополнительные приложения и библиотеки;
   - **Rocky Linux 10 – BaseOS** — базовые системные пакеты;
   - **Rocky Linux 10 – Extras** — дополнительные служебные пакеты.  

   Полученная информация подтверждает корректную настройку репозиториев и их доступность для пакетного менеджера.

4. Выполнен поиск пакетов, в названии или описании которых присутствует слово *user*.  
   В результате был получен перечень пакетов, относящихся к управлению пользовательскими учётными записями, системным службам и графическим интерфейсам.  
   Данный вывод демонстрирует, что поиск выполняется как по имени пакета, так и по его описанию.

   ![Поиск пакетов со словом user](Screenshot_2.png)

5. Перед установкой сетевой утилиты **nmap** были изучены доступные пакеты и информация о них.  
   В ходе просмотра получены сведения о версии пакета, архитектуре, используемом репозитории, лицензии и назначении программы.  
   После этого был установлен пакет nmap, в процессе установки произведён импорт GPG-ключа репозитория.

   ![Поиск пакетов со словом nmap](Screenshot_3.png)

   Дополнительно была выполнена установка с использованием шаблона имени пакета.  
   Разница между установкой одного пакета и установкой с использованием шаблона заключается в следующем:
   - установка `nmap` добавляет только основной пакет;
   - установка `nmap*` приводит к установке всех пакетов, начинающихся с `nmap`, включая дополнительные утилиты, такие как **nmap-ncat**.

   ![Установка пакета nmap](Screenshot_4.png)

6. Для удаления установленного программного обеспечения была выполнена деинсталляция пакета nmap.  
   При удалении с использованием шаблона имени дополнительно был удалён связанный пакет **nmap-ncat**, что позволило полностью очистить систему от компонентов nmap.

   ![Удаление пакета nmap и связанных компонентов](Screenshot_5.png)

7. Получен список доступных и установленных групп пакетов.  
   В выводе отображены окружения установки, уже установленные группы, а также дополнительные группы, доступные для установки.  
   Далее была изучена информация о группе **RPM Development Tools**, после чего данная группа пакетов была установлена в систему.

   ![Список групп пакетов](Screenshot_6.png)
   
   ![Установка групп пакетов](Screenshot_7.png)


8. При попытке удаления группы пакетов **RPM Development Tools** произошла ошибка библиотеки.  
   В процессе выполнения операции зафиксировано сообщение об ошибке, связанное с библиотекой **librpm_sequoia**, указывающее на отсутствие требуемого символа версии OpenSSL.  
   Это свидетельствует о несовместимости версии библиотеки RPM с установленной версией OpenSSL, что привело к сбою работы пакетного менеджера.

   ![Ошибка библиотеки при удалении группы пакетов](Screenshot_8.png)

9. Аналогичная ошибка библиотеки возникла при попытке просмотра истории использования пакетного менеджера.  
   В результате выполнение команд просмотра истории и отката транзакций оказалось невозможным, что подтверждает системный характер ошибки, связанной с библиотеками RPM и OpenSSL.

   ![Ошибка при выполнении dnf history](Screenshot_9.png)

**операционная система была переустановлена**, после чего было выполнено **полное обновление системы**.  
Данные действия были произведены с целью устранения ранее возникших ошибок библиотек и обеспечения корректной работы пакетного менеджера DNF.  
После обновления системы все дальнейшие действия были **повторены заново**.

1. После переустановки системы и выполнения обновления произведена проверка истории использования пакетного менеджера.  
   В истории отображены выполненные операции, включая установку и удаление группы пакетов **RPM Development Tools**, а также обновление системы.  
   Это подтверждает корректную работу DNF после переустановки и обновления ОС.

   ![Просмотр истории использования DNF](Screenshot_10.png)

2. Для восстановления удалённой группы пакетов выполнён откат операции с использованием механизма истории транзакций.  
   В результате была повторно установлена группа **RPM Development Tools**, что подтверждается успешным завершением транзакции и отсутствием ошибок библиотек.

   Данный этап показывает возможность использования команды отката для возврата системы к предыдущему состоянию без необходимости ручной установки пакетов.

3. После успешного восстановления группы пакетов было подтверждено, что:
   - пакетный менеджер DNF функционирует корректно;
   - ошибки, связанные с библиотекой **librpm_sequoia** и OpenSSL, более не возникают;
   - повторное выполнение всех этапов работы прошло без сбоев.

## Использование rpm для установки пакета lynx из локального RPM

1. Для установки текстового браузера **lynx** из RPM-пакета сначала была проверена доступность пакета в репозиториях.  
   После подтверждения наличия пакета выполнена загрузка RPM-файла без установки в систему (режим *download only*).  
   Это позволило получить установочный файл в кэше DNF и далее установить его вручную с использованием `rpm`.

   ![Проверка наличия lynx и загрузка RPM-пакета без установки](Screenshot_11.png)

2. После загрузки был определён каталог, в который DNF сохранил скачанный пакет.  
   Поиск выполнялся в дереве `/var/cache/dnf/` по маске `lynx*`.  
   В результате был найден RPM-файл вида `lynx-<версия>.x86_64.rpm` в каталоге пакетов репозитория AppStream (подкаталог `.../packages`).

3. Выполнен переход в найденный каталог с RPM-пакетом, после чего произведена установка локального файла с использованием RPM.  
   Установка прошла успешно, что подтвердилось выводом процесса проверки и установки пакета.

   ![Установка локального RPM и получение сведений о пакете](Screenshot_12.png)

4. После установки определено расположение исполняемого файла программы.  
   Результат проверки показал, что исполняемый файл расположен в стандартном системном каталоге: `/usr/bin/lynx`.

5. Используя средства RPM, определено, к какому пакету относится найденный исполняемый файл.  
   Проверка показала принадлежность файла `/usr/bin/lynx` пакету **lynx** соответствующей версии и архитектуры.  
   Далее получена расширенная информация о пакете: версия, релиз, архитектура, дата установки, источник, информация о сопровождении и краткое описание назначения.

6. Получен список всех файлов, установленных из пакета.  
   Вывод включает исполняемый файл, конфигурационные файлы, документацию и вспомогательные данные, установленные в системные каталоги.

   ![Список файлов, входящих в пакет lynx](Screenshot_13.png)

   Дополнительно выведен перечень файлов документации, относящихся к пакету **lynx**.  
   В выводе представлены файлы README, изменения версий и другие справочные материалы, размещённые в `/usr/share/doc/lynx/`.

   ![Перечень файлов документации пакета lynx](Screenshot_14.png)

   Для проверки корректности справочной документации и ознакомления с возможностями программы была открыта страница руководства `man lynx`.

   ![Просмотр man-страницы lynx](Screenshot_15.png)

7. Получен перечень конфигурационных файлов пакета.  
   Вывод показал размещение конфигурации в каталоге `/etc/`, включая основные файлы настройки lynx.

8. Выполнена проверка наличия скриптов, запускаемых при установке/удалении пакета.  
   Такие скрипты предназначены для автоматизации действий жизненного цикла пакета (например: создание/обновление конфигурации, регистрация компонентов, выполнение действий при установке и удалении).  
   При наличии скриптов они выводятся RPM как части сценариев *pre/post install* и *pre/post uninstall*.

9. В отдельном терминале под пользовательской учётной записью был запущен текстовый браузер **lynx** для проверки корректности установки.  
   Программа успешно открыла стартовую страницу Rocky Linux, что подтверждает работоспособность установленного приложения.

   ![Проверка запуска lynx под обычной учётной записью](Screenshot_16.png)

10. После проверки выполнено удаление пакета **lynx** с использованием RPM.  
    По завершении деинсталляции выполнена проверка содержимого каталога, в котором ранее находился скачанный RPM-файл, чтобы убедиться в наличии/отсутствии установочного файла и завершённости операции удаления установленного пакета.

    ![Удаление пакета lynx и проверка файлов в каталоге](Screenshot_17.png)

## Использование rpm и dnf для работы с пакетом dnsmasq

1. Для установки DNS-, DHCP- и TFTP-сервера **dnsmasq** была проверена доступность пакета в репозиториях системы.  
   После этого выполнена установка пакета. Пакет оказался уже установленным в системе, что подтверждается выводом пакетного менеджера.  
   Далее было определено расположение исполняемого файла сервиса, который находится в каталоге `/usr/sbin/`.

   ![Проверка наличия и установка пакета dnsmasq, определение пути к исполняемому файлу](Screenshot_18.png)

2. С использованием средств RPM определено, к какому пакету относится исполняемый файл **dnsmasq**.  
   Проверка показала, что файл `/usr/sbin/dnsmasq` принадлежит пакету **dnsmasq** соответствующей версии и архитектуры.  
   Далее была получена расширенная информация о пакете, включающая версию, релиз, дату установки, источник сборки, лицензию и подробное описание назначения сервиса.

   ![Определение принадлежности файла пакету и просмотр информации rpm -qi](Screenshot_19.png)

3. Получен полный список файлов, установленных из пакета **dnsmasq**.  
   В выводе присутствуют исполняемые файлы, конфигурационные каталоги, systemd-юнит сервиса, файлы документации и лицензии.  

   Дополнительно был выведен перечень файлов документации пакета, включающий руководства, справочные HTML-файлы и страницу руководства.

   ![Список файлов пакета и документации dnsmasq](Screenshot_20.png)

   Для ознакомления с возможностями и параметрами сервиса была открыта страница руководства `man dnsmasq`.

   ![Просмотр man-страницы dnsmasq](Screenshot_21.png)

4. Получен перечень конфигурационных файлов пакета.  
   Конфигурация dnsmasq размещается в каталоге `/etc/`, включая основной файл конфигурации и дополнительные системные конфигурационные файлы, используемые при запуске сервиса.

5. Выполнен просмотр скриптов, которые выполняются на различных этапах жизненного цикла пакета.  
   В выводе отображены:
   - *preinstall-скрипт*, предназначенный для создания системного пользователя и группы dnsmasq;
   - *postinstall-скрипт*, выполняющий регистрацию и установку systemd-юнита сервиса;
   - *preuninstall-скрипт*, отвечающий за корректное удаление systemd-юнита при деинсталляции;
   - *postuninstall-скрипт*, выполняющий дополнительные действия при обновлении или удалении пакета.  

   Данные скрипты обеспечивают корректную интеграцию сервиса dnsmasq в систему и его правильную работу с systemd.

   ![Просмотр скриптов установки и удаления пакета dnsmasq](Screenshot_22.png)

6. После завершения проверки корректности установки и структуры пакета выполнено удаление пакета **dnsmasq** с использованием RPM.  
   Это завершило цикл установки, анализа и деинсталляции пакета DNS/DHCP/TFTP-сервера.

# Контрольные вопросы

1. Для поиска rpm-пакета, содержащего файл **useradd**, используется команда:
   - **rpm -qf /usr/sbin/useradd** — определяет, какому установленному пакету принадлежит указанный файл.  
   Если пакет не установлен, применяется поиск по репозиториям:
   - **dnf provides */useradd** — ищет пакет, в состав которого входит данный файл.

2. Для определения имени группы DNF, содержащей инструменты безопасности, и просмотра её состава используются следующие команды:
   - **dnf groups list** — выводит список всех доступных и установленных групп пакетов;
   - **dnf groups info "Security Tools"** — отображает подробную информацию о группе инструментов безопасности и список входящих в неё пакетов.

3. Для установки rpm-пакета, загруженного из Интернета и не находящегося в репозиториях, используется команда:
   - **rpm -Uhv имя_пакета.rpm** — устанавливает или обновляет локальный RPM-пакет с выводом подробной информации о процессе.

4. Для проверки содержимого сценариев rpm-пакета и убеждения в отсутствии опасного кода используется команда:
   - **rpm -q --scripts имя_пакета.rpm** — выводит все скрипты, которые выполняются при установке, обновлении или удалении пакета.

5. Для просмотра всей документации, входящей в rpm-пакет, используется команда:
   - **rpm -qd имя_пакета** — выводит список файлов документации, поставляемых вместе с пакетом.

6. Для определения того, какому rpm-пакету принадлежит конкретный файл, применяется команда:
   - **rpm -qf путь_к_файлу** — показывает имя пакета, в состав которого входит указанный файл.

# Заключение

В ходе выполнения лабораторной работы были изучены принципы управления программными пакетами в операционной системе Rocky Linux с использованием инструментов **dnf** и **rpm**. Были рассмотрены способы работы с репозиториями, поиска, установки, удаления пакетов, а также управления группами пакетов и анализа истории транзакций.

На практике выполнена установка и удаление программных пакетов, получена информация о содержимом rpm-пакетов, их конфигурационных файлах, документации и сценариях установки. Отдельное внимание уделено установке пакетов из локальных RPM-файлов и проверке их корректной интеграции в систему.

В процессе работы была выявлена ошибка, связанная с несовместимостью библиотек RPM и OpenSSL, что привело к нарушению работы пакетного менеджера. Проблема была устранена путём переустановки и обновления системы, после чего все действия были успешно повторены.
